# Procedimento Manual Para Deploy na AWS

# Certifique-se de concluir o Capítulo 6 e criar o modelo e o padronizador.


##### Deploy Local #####


# Modo de Desenvolvimento:
flask run

# Modo de Produção (Threads):
gunicorn -w 4 app:app


##### Deploy na AWS #####


# Download do Miniconda
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh

# Instalação dos pacotes
pip install -r requirements.txt

# Inicializa
gunicorn -w 4 app:app
gunicorn --bind 0.0.0.0:8000 app:app

# Acessa (coloque aqui o endereço da sua instância EC2)
http://ec2-18-227-10-199.us-east-2.compute.amazonaws.com:8000

# Criando Serviço

# Verifica usuário e grupo
id -un
id -gn

# Cria o arquivo de serviço
sudo nano /etc/systemd/system/gunicorn.service

# Conteúdo do arquivo de serviço
[Unit]
Description=Gunicorn instance to serve application
After=network.target

[Service]
User=ec2-user
Group=ec2-user
WorkingDirectory=/home/ec2-user/Cap07
Environment="PATH=/home/ec2-user/miniconda3/bin"
ExecStart=/home/ec2-user/miniconda3/bin/gunicorn --workers 3 --bind 0.0.0.0:8000 app:app
ExecReload=/bin/kill -s HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true

[Install]
WantedBy=multi-user.target

# Gerencia o serviço
sudo systemctl daemon-reload
sudo systemctl enable gunicorn
sudo systemctl start gunicorn
sudo systemctl status gunicorn
sudo systemctl restart gunicorn
sudo systemctl stop gunicorn
journalctl -u gunicorn


